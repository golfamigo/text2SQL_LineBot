# 預約系統時區處理更新說明

## 更新概述
為了讓系統能夠更好地支援多時區運作，我們對預約系統進行了以下更新：

1. 增加商家時區設定
2. 改進時段判斷邏輯
3. 統一使用 UTC 時間儲存
4. 新增時區轉換輔助函數

## 資料庫變更
1. `n8n_booking_businesses` 表新增 `timezone` 欄位
2. `n8n_booking_time_periods` 表新增 `start_minutes` 和 `end_minutes` 欄位

## 新增函數
1. `convert_timezone`: 在不同時區間轉換時間
2. `time_to_minutes`: 將時間轉換為分鐘數
3. `minutes_to_time`: 將分鐘數轉換回時間格式

## 運作邏輯
1. 所有時間都以 UTC 形式儲存在資料庫中
2. 進行時段判斷時，先將時間轉換到商家的時區
3. 使用分鐘數進行時段比較，避免時區轉換的複雜性

## 使用須知
1. 在建立商家時，請務必設定正確的時區
2. 前端顯示時間時，應該根據用戶端時區進行轉換
3. API 傳入的時間必須包含時區資訊

## 更新步驟
1. 執行 `update_database.sql` 更新資料庫結構
2. 執行 `timezone_utils.sql` 建立輔助函數
3. 更新 `create_booking.sql` 函數

## 測試建議
1. 測試不同時區的商家
2. 測試跨日期的預約
3. 測試日光節約時間的情況

## 注意事項
1. 更新後，建議檢查現有的預約記錄
2. 確保所有相關的 N8N 工作流程都有正確處理時區資訊
3. 建議在測試環境中先進行完整測試