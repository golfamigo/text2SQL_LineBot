# Vous Aimer 花藝課程預約系統 - Autogen 使用說明

## 系統概述

這個系統是基於 AutoGen Studio 搭建的多代理智能預約管理系統，專為 Vous Aimer 花藝工作室設計。系統透過多個專業智能代理協同工作，提供完整的預約管理、服務管理和時段管理功能，並與 Line Bot 和 Google 日曆緊密整合。

## 核心功能

1. **預約管理**
   - 建立新預約
   - 修改預約
   - 取消預約
   - 查詢預約狀態

2. **時段管理**
   - 查詢可用時段
   - 管理時段設置
   - 預約時段限制設定

3. **服務管理**
   - 新增/修改/停用服務項目
   - 設定服務容量與價格
   - 設定服務提前預約時間

4. **Line Bot 整合**
   - 通過 Line 接收並回應用戶預約請求
   - 支援文字和語音輸入
   - 智能理解用戶需求

5. **Google 日曆整合**
   - 自動同步預約到日曆
   - 修改/取消預約時自動更新日曆
   - 日曆事件管理

## 系統架構

系統由以下智能代理組成：

### 1. 預約助理 (主要用戶交互代理)
- 負責接收和理解用戶請求
- 協調其他專業代理
- 向用戶收集必要信息
- 確認用戶意圖
- 提供最終回應

### 2. 預約創建代理
- 處理新預約請求
- 驗證預約信息
- 檢查時段和服務可用性
- 創建預約記錄
- 處理日曆同步

### 3. 預約管理代理
- 處理預約修改
- 處理預約取消
- 更新日曆事件

### 4. 時段查詢代理
- 提供各類時段可用性查詢
- 呈現清晰的時段信息

### 5. 服務管理代理
- 處理服務項目的新增、修改和停用
- 管理服務時段限制

### 6. 時段管理代理
- 處理時段的新增、修改和停用

## 工作流程

系統包含五個主要工作流程：

1. **新預約流程**
   - 接收用戶預約請求 → 確認時段和服務可用性 → 創建預約 → 同步到日曆 → 確認成功

2. **預約修改流程**
   - 接收修改請求 → 查詢現有預約 → 確認新選項可用性 → 執行修改 → 更新日曆 → 確認成功

3. **預約取消流程**
   - 接收取消請求 → 確認取消意圖 → 執行取消 → 從日曆移除 → 確認成功

4. **時段查詢流程**
   - 接收查詢 → 確定查詢類型 → 執行查詢 → 呈現結果

5. **服務管理流程**
   - 接收管理請求 → 確認身份和權限 → 執行操作 → 確認結果

## 部署說明

### 前置需求

1. **OpenAI API 金鑰**
   - 用於智能代理的運作
   - 建議使用 GPT-4 或更高等級的模型

2. **PostgreSQL 數據庫**
   - 確保數據庫中已設置所有必要的表格
   - 適當的數據庫訪問權限

3. **Line Bot 設置**
   - Line Channel Secret
   - Line Channel Access Token
   - 配置好的 Webhook URL

4. **Google API 憑證**
   - Google 日曆 API 啟用
   - 適當的 OAuth 設置

### 安裝步驟

1. 在 Zeabur 平台部署應用
   ```
   zeabur deploy --config booking-autogen.yaml
   ```

2. 環境變量設置
   - `OPENAI_API_KEY`：OpenAI API 金鑰
   - `DATABASE_URL`：PostgreSQL 連接 URL
   - `LINE_CHANNEL_SECRET`：Line Bot Channel Secret
   - `LINE_CHANNEL_ACCESS_TOKEN`：Line Bot Access Token
   - `GOOGLE_CALENDAR_ID`：Google 日曆 ID
   - `TIMEZONE`：時區設置 (預設 Asia/Taipei)

3. 配置 Line Bot Webhook
   - 將 Line Bot 的 Webhook URL 設置為您部署的服務 URL + `/vousaimer`

4. 配置 Google 日曆
   - 上傳 Google API 憑證 JSON 文件
   - 授權應用訪問您的 Google 日曆

## 測試和使用

### Line Bot 使用
用戶可以通過 Line 與系統互動，執行以下操作：

1. **預約課程**
   ```
   我想預約花藝體驗課程
   ```

2. **查詢時段**
   ```
   3月15日有哪些時段可以上花藝課？
   ```

3. **取消預約**
   ```
   我想取消我的預約
   ```

4. **修改預約**
   ```
   我需要把預約改到下週四下午
   ```

5. **查詢服務**
   ```
   有哪些課程可以選擇？
   ```

### 管理員操作
管理員可以通過系統執行以下操作：

1. **管理服務**
   ```
   新增一個香氛蠟燭DIY課程，90分鐘，最多10人
   ```

2. **管理時段**
   ```
   新增一個下午時段，從14:00到17:00
   ```

3. **設置限制**
   ```
   設定花藝體驗課程在上午時段不可預約
   ```

## 常見問題處理

### 系統無法回應
- 檢查 OpenAI API 金鑰是否有效
- 確認 Line Bot 設置是否正確
- 檢查數據庫連接是否正常

### 預約無法同步到日曆
- 檢查 Google API 憑證是否有效
- 確認日曆 ID 是否正確
- 檢查 OAuth 授權是否完成

### 時區問題
- 確保環境變量中的 TIMEZONE 設置正確
- 確認數據庫中的時間處理正確

## 自定義和擴展

您可以通過修改 `booking-autogen.yaml` 文件來自定義系統：

1. **調整代理提示**
   - 修改各代理的 `prompt_template` 來調整其行為

2. **添加新的工作流程**
   - 在 `workflows` 部分添加新的工作流程定義

3. **擴展整合功能**
   - 在 `integration` 部分添加新的整合選項

4. **添加新的代理**
   - 在 `agents` 部分定義新的專業代理

## 結語

這個多代理預約系統設計以用戶體驗為中心，通過智能代理間的協作提供高效、專業的預約管理服務。系統具有高度的可擴展性，可以根據業務需求進行調整和擴展。

如需技術支援或有任何問題，請聯絡系統管理員。
